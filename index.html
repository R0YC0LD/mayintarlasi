<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pou: Ultimate Mobile</title>
    <style>
        /* --- TEMEL AYARLAR --- */
        :root {
            --bg-kitchen: #ffeaa7;
            --bg-bedroom: #74b9ff;
            --bg-bathroom: #fab1a0;
            --ui-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }
        
        body {
            margin: 0; padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            background: #333;
            touch-action: none; /* Mobilde kaydƒ±rmayƒ± engeller, oyun kontrol√ºne bƒ±rakƒ±r */
        }

        /* --- OYUN D√úNYASI (KAYDIRILABƒ∞Lƒ∞R ALAN) --- */
        #game-viewport {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #fff;
        }

        #world-container {
            display: flex;
            width: 300vw; /* 3 Oda yan yana */
            height: 100%;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .room {
            width: 100vw;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #room-kitchen { background: radial-gradient(circle, #fff 10%, var(--bg-kitchen) 90%); }
        #room-bedroom { background: radial-gradient(circle, #fff 10%, var(--bg-bedroom) 90%); }
        #room-bathroom { background: radial-gradient(circle, #fff 10%, var(--bg-bathroom) 90%); }

        /* ODA ETƒ∞KETƒ∞ */
        .room-label {
            position: absolute; top: 20%; 
            font-size: 80px; opacity: 0.1; font-weight: bold; pointer-events: none;
        }

        /* --- POU (SABƒ∞T KATMAN) --- */
        /* Pou ekranda sabit durur, arkasƒ±ndaki d√ºnya kayar */
        #character-layer {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 200px; height: 200px;
            pointer-events: none; /* Tƒ±klamalar arkaya ge√ßsin diye, ama Pou'nun kendisi pointer-events alacak */
            z-index: 10;
        }

        #pou-body {
            width: 180px; height: 160px;
            background: #e67e22;
            border-radius: 50% 50% 45% 45%;
            position: relative;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.1), 0 10px 20px rgba(0,0,0,0.2);
            margin: 0 auto;
            pointer-events: auto; /* Pou'ya dokunulabilsin */
            transition: transform 0.2s;
            display: flex; justify-content: center;
        }

        /* G√∂zler */
        .eyes { display: flex; gap: 15px; position: absolute; top: 40px; }
        .eye {
            width: 45px; height: 45px; background: white; border-radius: 50%;
            border: 4px solid #333; position: relative; overflow: hidden;
        }
        .pupil {
            width: 16px; height: 16px; background: #222; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        /* Aƒüƒ±z */
        .mouth {
            width: 30px; height: 15px;
            border-bottom: 5px solid #333; border-radius: 50%;
            position: absolute; bottom: 35px;
            transition: all 0.2s;
        }

        /* Kirler (Absolute to Pou) */
        .dirt {
            position: absolute; width: 35px; height: 35px;
            background: #6d4c41; border-radius: 50%;
            opacity: 0.8; filter: blur(3px);
            z-index: 20; pointer-events: auto;
        }

        /* --- ARAY√úZ (UI) --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
        }

        /* √úst Bilgi */
        .top-bar {
            display: flex; justify-content: space-between; padding: 20px;
            pointer-events: auto;
        }
        .stat-box {
            background: rgba(255,255,255,0.9); padding: 8px 15px;
            border-radius: 20px; font-weight: bold; color: #444;
            box-shadow: var(--ui-shadow); display: flex; gap: 5px; align-items: center;
        }

        /* Barlar */
        .bars-container {
            position: absolute; top: 70px; left: 50%; transform: translateX(-50%);
            width: 60%; display: flex; gap: 5px;
        }
        .bar-bg { flex: 1; height: 8px; background: rgba(0,0,0,0.2); border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; width: 100%; transition: width 0.5s; }

        /* Alt Kontroller (Odaya g√∂re deƒüi≈üir) */
        #dock-kitchen, #dock-bathroom, #dock-bedroom {
            position: absolute; bottom: 30px; width: 100%;
            display: none; justify-content: center; gap: 20px;
            pointer-events: auto;
            animation: slideUp 0.3s;
        }

        .item-icon {
            width: 70px; height: 70px; background: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 35px; box-shadow: var(--ui-shadow); cursor: pointer;
            transition: transform 0.1s; border: 3px solid transparent;
        }
        .item-icon:active { transform: scale(0.9); }
        .item-icon.active { border-color: #0984e3; background: #e1f5fe; }

        /* S√ºr√ºklenebilir Nesneler */
        .draggable {
            position: absolute; font-size: 50px; z-index: 150; pointer-events: none;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2));
        }

        /* Bildirim */
        #toast {
            position: absolute; top: 120px; left: 50%; transform: translateX(-50%);
            background: #2d3436; color: white; padding: 10px 20px; border-radius: 25px;
            opacity: 0; transition: opacity 0.3s;
        }

        /* Animasyonlar */
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes chew { 0%,100% { height: 10px; } 50% { height: 25px; background:#333; border-radius:50%; border:none; } }
        @keyframes sleeping { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Gece Modu */
        .dark-overlay {
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,30,0.8);
            pointer-events: none; opacity: 0; transition: opacity 1s; z-index: 90;
        }
    </style>
</head>
<body>

    <div id="game-viewport">
        <div id="night-mask" class="dark-overlay"></div>

        <div id="world-container">
            <div class="room" id="room-bedroom">
                <div class="room-label">UYKU</div>
            </div>
            <div class="room" id="room-kitchen">
                <div class="room-label">MUTFAK</div>
            </div>
            <div class="room" id="room-bathroom">
                <div class="room-label">BANYO</div>
            </div>
        </div>

        <div id="character-layer">
            <div id="pou-body">
                <div class="eyes">
                    <div class="eye"><div class="pupil" id="p-left"></div></div>
                    <div class="eye"><div class="pupil" id="p-right"></div></div>
                </div>
                <div class="mouth" id="mouth"></div>
                </div>
        </div>

        <div id="ui-layer">
            <div class="top-bar">
                <div class="stat-box">üí∞ <span id="coin-disp">100</span></div>
                <div class="stat-box">‚≠ê Lvl <span id="lvl-disp">1</span></div>
            </div>
            
            <div class="bars-container">
                <div class="bar-bg"><div class="bar-fill" style="background:#ff7675" id="fill-hunger"></div></div>
                <div class="bar-bg"><div class="bar-fill" style="background:#74b9ff" id="fill-clean"></div></div>
                <div class="bar-bg"><div class="bar-fill" style="background:#ffeaa7" id="fill-energy"></div></div>
            </div>

            <div id="toast">Oyun Ba≈üladƒ±!</div>

            <div id="dock-bedroom">
                <div class="item-icon" onclick="toggleLamp()">üí°</div>
                <div class="item-icon" onclick="toggleMic()">üé§</div>
            </div>

            <div id="dock-kitchen">
                <div class="item-icon" onmousedown="startDrag(event, 'üçï')" ontouchstart="startDrag(event, 'üçï')">üçï</div>
                <div class="item-icon" onmousedown="startDrag(event, 'üçé')" ontouchstart="startDrag(event, 'üçé')">üçé</div>
                <div class="item-icon" onmousedown="startDrag(event, 'üç¶')" ontouchstart="startDrag(event, 'üç¶')">üç¶</div>
            </div>

            <div id="dock-bathroom">
                <div class="item-icon" id="btn-sponge" onmousedown="startTool(event, 'sponge')" ontouchstart="startTool(event, 'sponge')">üßΩ</div>
                <div class="item-icon" id="btn-shower" onmousedown="startTool(event, 'shower')" ontouchstart="startTool(event, 'shower')">üöø</div>
            </div>
        </div>
    </div>

    <script>
        /* --- OYUN VERƒ∞LERƒ∞ --- */
        const state = {
            hunger: 80,
            clean: 50,
            energy: 90,
            coins: 100,
            level: 1,
            currentRoom: 1, // 0: Bedroom, 1: Kitchen, 2: Bathroom
            isSleeping: false,
            dirtCount: 0
        };

        const world = document.getElementById('world-container');
        const pou = document.getElementById('pou-body');
        const mouth = document.getElementById('mouth');

        /* --- BA≈ûLATMA --- */
        function init() {
            updateRoomUI(1); // Mutfakta ba≈ülat
            updateStats();
            spawnDirt(5); // Ba≈ülangƒ±√ß kirleri
            
            // Oyun D√∂ng√ºs√º
            setInterval(gameLoop, 2000); // ƒ∞statistik d√º≈ü√º≈ü√º
            setInterval(randomDirtLoop, 10000); // Ara sƒ±ra kirlenme

            // G√∂z Takibi
            document.addEventListener('mousemove', moveEyes);
            document.addEventListener('touchmove', moveEyes, {passive:false});
            
            // Animasyon
            pou.style.animation = "sleeping 3s infinite ease-in-out";
        }

        /* --- KAYDIRMA (SWIPE) MANTIƒûI --- */
        let touchStartX = 0;
        let touchEndX = 0;
        let isSwiping = false;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, {passive: false});

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: false});

        // Mouse ile kaydƒ±rma testi i√ßin
        document.addEventListener('mousedown', e => touchStartX = e.screenX);
        document.addEventListener('mouseup', e => { touchEndX = e.screenX; handleSwipe(); });

        function handleSwipe() {
            // Eƒüer bir nesne s√ºr√ºkleniyorsa oda deƒüi≈ütirmeyi engelle
            if (activeDragItem || activeTool) return;

            const threshold = 50; // Hassasiyet
            if (touchEndX < touchStartX - threshold) {
                // Sola Kaydƒ±r (Oda ƒ∞ndex Artar)
                changeRoom(state.currentRoom + 1);
            }
            if (touchEndX > touchStartX + threshold) {
                // Saƒüa Kaydƒ±r (Oda ƒ∞ndex Azalƒ±r)
                changeRoom(state.currentRoom - 1);
            }
        }

        function changeRoom(index) {
            if (index < 0 || index > 2) return; // Sƒ±nƒ±rlar
            state.currentRoom = index;
            
            // Kaydƒ±rma Efekti
            world.style.transform = `translateX(-${index * 100}vw)`;
            
            // UI G√ºncelleme
            updateRoomUI(index);
        }

        function updateRoomUI(index) {
            // √ñnce hepsini gizle
            document.getElementById('dock-bedroom').style.display = 'none';
            document.getElementById('dock-kitchen').style.display = 'none';
            document.getElementById('dock-bathroom').style.display = 'none';

            // ƒ∞lgili olanƒ± a√ß
            if (index === 0) document.getElementById('dock-bedroom').style.display = 'flex';
            if (index === 1) document.getElementById('dock-kitchen').style.display = 'flex';
            if (index === 2) document.getElementById('dock-bathroom').style.display = 'flex';
        }

        /* --- S√úR√úKLE BIRAK Sƒ∞STEMƒ∞ (YEMEK & ARA√áLAR) --- */
        let activeDragItem = null;
        let activeTool = null; // sponge or shower

        // --- YEMEK YEME ---
        function startDrag(e, emoji) {
            e.preventDefault();
            e.stopPropagation(); // Swipe'ƒ± engelle
            
            const el = document.createElement('div');
            el.className = 'draggable';
            el.innerText = emoji;
            document.body.appendChild(el);
            
            activeDragItem = el;
            moveItem(e);

            document.addEventListener('mousemove', moveItem);
            document.addEventListener('touchmove', moveItem, {passive: false});
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }

        function moveItem(e) {
            if (!activeDragItem) return;
            const x = e.clientX || e.touches[0].clientX;
            const y = e.clientY || e.touches[0].clientY;
            activeDragItem.style.left = (x - 25) + 'px';
            activeDragItem.style.top = (y - 25) + 'px';
        }

        function endDrag(e) {
            if (!activeDragItem) return;

            // Aƒüƒ±z ile √ßarpƒ±≈üma kontrol√º
            const mouthRect = mouth.getBoundingClientRect();
            const itemRect = activeDragItem.getBoundingClientRect();

            // Basit √ßarpƒ±≈üma
            const overlap = !(itemRect.right < mouthRect.left || 
                            itemRect.left > mouthRect.right || 
                            itemRect.bottom < mouthRect.top || 
                            itemRect.top > mouthRect.bottom);

            if (overlap) {
                eatFood();
            }

            activeDragItem.remove();
            activeDragItem = null;
            document.removeEventListener('mousemove', moveItem);
            document.removeEventListener('touchmove', moveItem);
        }

        function eatFood() {
            if(state.isSleeping) { showToast("Uyurken yiyemez!"); return; }
            mouth.style.animation = "chew 0.5s infinite";
            setTimeout(() => mouth.style.animation = "", 1000);
            
            state.hunger = Math.min(100, state.hunger + 15);
            state.coins += 5;
            spawnDirt(1); // Yemek yerken bazen kirlenir
            updateStats();
            showToast("Leziz! +5 Altƒ±n");
        }

        // --- TEMƒ∞ZLƒ∞K Sƒ∞STEMƒ∞ (GELƒ∞≈ûMƒ∞≈û) ---
        function startTool(e, type) {
            e.preventDefault();
            e.stopPropagation();
            
            const el = document.createElement('div');
            el.className = 'draggable';
            el.innerText = type === 'sponge' ? 'üßΩ' : 'üöø';
            el.style.zIndex = "200";
            document.body.appendChild(el);
            
            activeTool = { el: el, type: type };
            moveTool(e);

            document.addEventListener('mousemove', moveTool);
            document.addEventListener('touchmove', moveTool, {passive: false});
            document.addEventListener('mouseup', endTool);
            document.addEventListener('touchend', endTool);
        }

        function moveTool(e) {
            if (!activeTool) return;
            const x = e.clientX || e.touches[0].clientX;
            const y = e.clientY || e.touches[0].clientY;
            
            activeTool.el.style.left = (x - 25) + 'px';
            activeTool.el.style.top = (y - 25) + 'px';

            // Temizlik Tespiti (Anlƒ±k Kontrol)
            checkCleaning(x, y);
        }

        function checkCleaning(x, y) {
            // Ekrandaki t√ºm kirleri bul
            const dirts = document.querySelectorAll('.dirt');
            
            dirts.forEach(d => {
                const rect = d.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                // Mesafe Form√ºl√º (Distance Formula)
                // Aletin konumu (x,y) ile lekenin merkezi arasƒ±ndaki mesafe
                const dist = Math.hypot(x - centerX, y - centerY);

                // Eƒüer alet lekeye 40px kadar yakƒ±nsa
                if (dist < 40) {
                    if (activeTool.type === 'sponge') {
                        // S√ºnger: Lekenin opaklƒ±ƒüƒ±nƒ± d√º≈ü√ºr (k√∂p√ºrt)
                        let op = parseFloat(d.style.opacity || 0.8);
                        d.style.opacity = op - 0.05;
                        d.style.filter = "blur(5px) brightness(1.5)"; // K√∂p√ºk efekti
                        if (op < 0.3) d.classList.add('ready-to-rinse');
                    } else if (activeTool.type === 'shower') {
                        // Du≈ü: Sadece s√ºngerlenmi≈üse veya direkt temizle
                        d.remove();
                        state.clean = Math.min(100, state.clean + 10);
                        state.coins += 2;
                        updateStats();
                        showToast("Temizlendi! +2 Altƒ±n");
                    }
                }
            });
        }

        function endTool() {
            if(activeTool) activeTool.el.remove();
            activeTool = null;
            document.removeEventListener('mousemove', moveTool);
            document.removeEventListener('touchmove', moveTool);
        }

        function spawnDirt(count) {
            for(let i=0; i<count; i++) {
                const d = document.createElement('div');
                d.className = 'dirt';
                // Pou'nun i√ßinde rastgele konum (180x160)
                d.style.left = (Math.random() * 120 + 20) + 'px';
                d.style.top = (Math.random() * 100 + 30) + 'px';
                pou.appendChild(d);
            }
        }

        function randomDirtLoop() {
            if (!state.isSleeping && Math.random() > 0.5) {
                spawnDirt(1);
                state.clean -= 5;
                updateStats();
            }
        }

        /* --- Dƒ∞ƒûER √ñZELLƒ∞KLER --- */
        function toggleLamp() {
            state.isSleeping = !state.isSleeping;
            const mask = document.getElementById('night-mask');
            
            if (state.isSleeping) {
                mask.style.opacity = 1;
                pou.style.transform = "scale(0.95)";
                document.querySelectorAll('.eye').forEach(e => e.style.height = '5px'); // G√∂zleri kapat
                showToast("ƒ∞yi Geceler...");
            } else {
                mask.style.opacity = 0;
                pou.style.transform = "scale(1)";
                document.querySelectorAll('.eye').forEach(e => e.style.height = '45px'); // G√∂zleri a√ß
            }
        }

        /* --- ƒ∞STATƒ∞STƒ∞KLER VE D√ñNG√ú --- */
        function gameLoop() {
            if (state.isSleeping) {
                state.energy = Math.min(100, state.energy + 5);
                state.hunger -= 0.5;
            } else {
                state.hunger -= 1;
                state.energy -= 0.5;
                state.clean -= 0.2;
            }
            updateStats();
        }

        function updateStats() {
            // Sƒ±nƒ±rlandƒ±rma
            if(state.hunger < 0) state.hunger = 0;
            if(state.clean < 0) state.clean = 0;
            if(state.energy < 0) state.energy = 0;

            document.getElementById('fill-hunger').style.width = state.hunger + '%';
            document.getElementById('fill-clean').style.width = state.clean + '%';
            document.getElementById('fill-energy').style.width = state.energy + '%';
            document.getElementById('coin-disp').innerText = Math.floor(state.coins);
            
            // Renk Uyarƒ±larƒ±
            if(state.hunger < 20) document.getElementById('fill-hunger').style.backgroundColor = 'red';
            else document.getElementById('fill-hunger').style.backgroundColor = '#ff7675';
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 1500);
        }

        function moveEyes(e) {
            if(state.isSleeping) return;
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            
            // Her iki g√∂z i√ßin hesapla
            ['p-left', 'p-right'].forEach(id => {
                const pupil = document.getElementById(id);
                const rect = pupil.parentElement.getBoundingClientRect();
                const centerX = rect.left + rect.width/2;
                const centerY = rect.top + rect.height/2;
                
                const angle = Math.atan2(y - centerY, x - centerX);
                const dist = Math.min(5, Math.hypot(x - centerX, y - centerY)/15);
                
                pupil.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
            });
        }
        
        // Ses Taklit (Opsiyonel Basit S√ºr√ºm)
        function toggleMic() {
            showToast("Tekrar etme √∂zelliƒüi aktif (Demo)");
            // Buraya karma≈üƒ±k WebAudioAPI kodu eklenebilir, ≈üimdilik sadece g√∂rsel tepki.
            mouth.style.height = "20px";
            setTimeout(() => mouth.style.height = "10px", 500);
        }

        // Ba≈ülat
        init();

    </script>
</body>
</html>
