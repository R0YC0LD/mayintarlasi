<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pou: Ultimate Edition</title>
    <style>
        /* --- GENEL AYARLAR --- */
        :root {
            --primary-color: #ffcc00;
            --bg-gradient: linear-gradient(180deg, #87CEEB 0%, #E0F7FA 100%);
        }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- OYUN SAHNESƒ∞ --- */
        #game-stage {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 500px; /* Tablet/Mobil odaklƒ± geni≈ülik */
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- √úST ARAY√úZ --- */
        #top-bar {
            width: 90%;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .hud-badge {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #555;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        /* Barlar */
        .stat-bars {
            position: absolute;
            top: 70px;
            width: 60%;
            display: flex;
            gap: 5px;
            opacity: 0.8;
            z-index: 90;
        }
        .bar { flex: 1; height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px; overflow: hidden; }
        .fill { height: 100%; width: 100%; transition: width 0.5s; }

        /* --- KARAKTER (POU) --- */
        #character-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
        }

        #pou {
            width: 150px;
            height: 140px;
            background: radial-gradient(circle at 30% 30%, #e67e22, #d35400);
            border-radius: 50% 50% 45% 45%; /* Blob ≈üekli */
            position: relative;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.1), 0 20px 40px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            transition: transform 0.2s, width 0.5s, height 0.5s;
            z-index: 10;
        }

        /* G√∂zler */
        .eyes-row {
            display: flex;
            gap: 15px;
            margin-top: 35px;
            position: relative;
            z-index: 12;
        }
        .eye {
            width: 40px; height: 40px;
            background: white;
            border-radius: 50%;
            border: 3px solid #333;
            position: relative;
            overflow: hidden;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1);
        }
        .pupil {
            width: 14px; height: 14px;
            background: #222;
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            /* JavaScript ile hareket ettirilecek */
        }
        .shine {
            position: absolute; top: 8px; right: 8px;
            width: 8px; height: 8px; background: white; border-radius: 50%;
        }
        
        /* Aƒüƒ±z */
        .mouth {
            width: 20px; height: 10px;
            border-bottom: 4px solid #333;
            border-radius: 50%;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.2s;
            z-index: 12;
        }

        /* Kir / K√∂p√ºk Efektleri */
        .dirt-spot {
            position: absolute; width: 20px; height: 20px;
            background: rgba(90, 60, 40, 0.6);
            border-radius: 50%; filter: blur(2px);
            z-index: 11; pointer-events: none;
        }
        .bubble {
            position: absolute; width: 25px; height: 25px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: pop 0.3s ease-out;
            z-index: 13;
        }

        /* --- ALT MEN√ú (DOCK) --- */
        #bottom-dock {
            width: 90%;
            background: white;
            padding: 15px;
            border-radius: 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 100;
        }

        .dock-btn {
            background: none; border: none; font-size: 28px;
            cursor: pointer; transition: transform 0.2s; position: relative;
        }
        .dock-btn:active { transform: scale(0.9); }
        .dock-btn.active::after {
            content: ''; position: absolute; bottom: -5px; left: 50%;
            transform: translateX(-50%); width: 5px; height: 5px;
            background: #ffcc00; border-radius: 50%;
        }

        /* --- ETKƒ∞LE≈ûƒ∞M KATMANLARI --- */
        /* Yemek Men√ºs√º */
        #food-menu {
            position: absolute; bottom: 100px; width: 100%;
            display: none; justify-content: center; gap: 15px;
            animation: slideUp 0.3s; z-index: 90;
        }
        .food-item {
            font-size: 40px; cursor: grab; transition: transform 0.2s;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }
        .food-item:active { cursor: grabbing; transform: scale(1.2); }

        /* Banyo Ara√ßlarƒ± */
        #bath-tools {
            position: absolute; top: 100px; right: 20px;
            display: none; flex-direction: column; gap: 15px; z-index: 90;
        }
        .tool {
            width: 60px; height: 60px; background: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer; border: 3px solid transparent;
        }
        .tool.selected { border-color: #4ecdc4; background: #e0f7fa; }

        /* Draggable Food Element (Hareket eden yemek) */
        .draggable-food {
            position: absolute; font-size: 50px; z-index: 200; pointer-events: none;
        }

        /* Mouse Takip√ßisi (S√ºnger/Du≈ü) */
        #cursor-tool {
            position: absolute; font-size: 40px; z-index: 200; pointer-events: none; display: none;
        }

        /* Animasyonlar */
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes chew { 0% { height: 10px; } 50% { height: 25px; border-radius: 50%; background: #000; } 100% { height: 10px; } }
        
        /* Bildirim */
        #toast {
            position: absolute; top: 120px; background: #333; color: white;
            padding: 8px 16px; border-radius: 20px; font-size: 14px;
            opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 200;
        }

        .mic-active { color: #ff4757; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="game-stage">
        <div id="toast">Bildirim</div>

        <div id="top-bar">
            <div class="hud-badge">üí∞ <span id="coin-val">100</span></div>
            <div class="hud-badge">‚≠ê Lvl <span id="level-val">1</span></div>
            <button id="btn-mic" class="dock-btn" onclick="toggleMic()">üé§</button>
        </div>

        <div class="stat-bars">
            <div class="bar"><div class="fill" style="background:#ff7675; width:100%" id="bar-hunger"></div></div>
            <div class="bar"><div class="fill" style="background:#74b9ff; width:100%" id="bar-clean"></div></div>
            <div class="bar"><div class="fill" style="background:#ffeaa7; width:100%" id="bar-energy"></div></div>
        </div>

        <div id="bath-tools">
            <div class="tool" id="tool-sponge" onclick="selectTool('sponge')">üßΩ</div>
            <div class="tool" id="tool-shower" onclick="selectTool('shower')">üöø</div>
        </div>

        <div id="food-menu">
            <div class="food-item" onmousedown="startDragFood(event, 'üçï')" ontouchstart="startDragFood(event, 'üçï')">üçï</div>
            <div class="food-item" onmousedown="startDragFood(event, 'üçé')" ontouchstart="startDragFood(event, 'üçé')">üçé</div>
            <div class="food-item" onmousedown="startDragFood(event, 'ü•¶')" ontouchstart="startDragFood(event, 'ü•¶')">ü•¶</div>
            <div class="food-item" onmousedown="startDragFood(event, 'üç©')" ontouchstart="startDragFood(event, 'üç©')">üç©</div>
        </div>

        <div id="character-container">
            <div id="pou">
                <div class="eyes-row">
                    <div class="eye"><div class="pupil" id="p-left"></div><div class="shine"></div></div>
                    <div class="eye"><div class="pupil" id="p-right"></div><div class="shine"></div></div>
                </div>
                <div class="mouth" id="mouth"></div>
            </div>
        </div>

        <div id="bottom-dock">
            <button class="dock-btn" onclick="setMode('kitchen')">üç¥</button>
            <button class="dock-btn" onclick="setMode('bathroom')">üöø</button>
            <button class="dock-btn" onclick="toggleSleep()">üí°</button>
            <button class="dock-btn" onclick="showShop()">üõí</button>
        </div>

        <div id="cursor-tool"></div>
    </div>

    <script>
        // --- OYUN DURUMU ---
        const state = {
            hunger: 80, clean: 60, energy: 100,
            coins: 100, growth: 0,
            mode: 'idle', // kitchen, bathroom, bedroom
            activeTool: null,
            isSleeping: false
        };

        const pou = document.getElementById('pou');
        const mouth = document.getElementById('mouth');
        const cursorTool = document.getElementById('cursor-tool');
        
        // --- BA≈ûLANGI√á & D√ñNG√ú ---
        function init() {
            // Dirt (Kir) olu≈ütur
            generateDirt();
            
            // Loop ba≈ülat
            setInterval(gameLoop, 1000);
            
            // Event Listeners (G√∂z Takibi ve Tool Kullanƒ±mƒ± i√ßin)
            document.addEventListener('mousemove', handleInputMove);
            document.addEventListener('touchmove', handleInputMove, {passive: false});
            
            // Nefes Alma Animasyonu
            pou.style.animation = "breathe 3s infinite ease-in-out";
            
            updateUI();
        }

        function gameLoop() {
            if (state.isSleeping) {
                if(state.energy < 100) state.energy += 2;
                if(state.hunger > 0) state.hunger -= 0.5;
            } else {
                if(state.hunger > 0) state.hunger -= 1;
                if(state.energy > 0) state.energy -= 0.5;
                if(state.clean > 0) state.clean -= 0.5;
            }
            updateUI();
        }

        // --- G√ñZ TAKƒ∞Bƒ∞ & Fƒ∞Zƒ∞KSEL ETKƒ∞LE≈ûƒ∞M ---
        function handleInputMove(e) {
            let x, y;
            if (e.type === 'touchmove') {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }

            // 1. G√∂z Takibi
            movePupil('p-left', x, y);
            movePupil('p-right', x, y);

            // 2. Banyo Aracƒ± Takibi
            if (state.mode === 'bathroom' && state.activeTool) {
                cursorTool.style.display = 'block';
                cursorTool.style.left = x + 'px';
                cursorTool.style.top = y + 'px';
                
                // Pou'nun √ºzerine gelindi mi?
                const pouRect = pou.getBoundingClientRect();
                if (x > pouRect.left && x < pouRect.right && y > pouRect.top && y < pouRect.bottom) {
                    if (state.activeTool === 'sponge') scrub(x, y);
                    if (state.activeTool === 'shower') rinse(x, y);
                }
            } else {
                cursorTool.style.display = 'none';
            }
        }

        function movePupil(id, mouseX, mouseY) {
            const pupil = document.getElementById(id);
            const eye = pupil.parentElement;
            const eyeRect = eye.getBoundingClientRect();
            const eyeCenterX = eyeRect.left + eyeRect.width / 2;
            const eyeCenterY = eyeRect.top + eyeRect.height / 2;

            const angle = Math.atan2(mouseY - eyeCenterY, mouseX - eyeCenterX);
            const distance = Math.min(6, Math.hypot(mouseX - eyeCenterX, mouseY - eyeCenterY) / 10); // Sƒ±nƒ±rla

            pupil.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
        }

        // --- MOD DEƒûƒ∞≈ûƒ∞Mƒ∞ ---
        function setMode(newMode) {
            state.mode = newMode;
            
            // UI G√ºncelleme
            document.getElementById('food-menu').style.display = (newMode === 'kitchen') ? 'flex' : 'none';
            document.getElementById('bath-tools').style.display = (newMode === 'bathroom') ? 'flex' : 'none';
            
            if (newMode !== 'bathroom') {
                state.activeTool = null;
                document.querySelectorAll('.tool').forEach(t => t.classList.remove('selected'));
            } else {
                // Default tool
                selectTool('sponge');
            }
        }

        // --- YEMEK Sƒ∞STEMƒ∞ (DRAG & DROP) ---
        let draggedFood = null;

        function startDragFood(e, foodChar) {
            e.preventDefault();
            
            // Yeni bir element olu≈ütur
            const foodEl = document.createElement('div');
            foodEl.innerText = foodChar;
            foodEl.className = 'draggable-food';
            document.body.appendChild(foodEl);
            
            draggedFood = foodEl;
            
            // ƒ∞lk konum
            moveFood(e);

            // Dinleyiciler
            document.addEventListener('mousemove', moveFood);
            document.addEventListener('touchmove', moveFood, {passive: false});
            document.addEventListener('mouseup', endDragFood);
            document.addEventListener('touchend', endDragFood);
        }

        function moveFood(e) {
            if (!draggedFood) return;
            let x, y;
            if (e.type.startsWith('touch')) {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }
            draggedFood.style.left = (x - 25) + 'px';
            draggedFood.style.top = (y - 25) + 'px';
        }

        function endDragFood(e) {
            if (!draggedFood) return;
            
            // √áarpƒ±≈üma Kontrol√º (Aƒüƒ±z ile)
            const mouthRect = mouth.getBoundingClientRect();
            const foodRect = draggedFood.getBoundingClientRect();

            // Basit √ßarpƒ±≈üma mantƒ±ƒüƒ±
            if (foodRect.left < mouthRect.right &&
                foodRect.right > mouthRect.left &&
                foodRect.top < mouthRect.bottom &&
                foodRect.bottom > mouthRect.top) {
                
                eatFood();
            } else {
                // Geri d√º≈üme efekti eklenebilir ama ≈üimdilik silelim
            }

            draggedFood.remove();
            draggedFood = null;
            
            document.removeEventListener('mousemove', moveFood);
            document.removeEventListener('touchmove', moveFood);
            document.removeEventListener('mouseup', endDragFood);
            document.removeEventListener('touchend', endDragFood);
        }

        function eatFood() {
            if (state.hunger >= 100) { showToast("Karnƒ± Tok!"); return; }
            
            // √áiƒüneme Animasyonu
            mouth.style.animation = "chew 0.5s infinite";
            setTimeout(() => { mouth.style.animation = ""; }, 1500);
            
            state.hunger = Math.min(100, state.hunger + 15);
            state.growth += 5;
            checkGrowth();
            showToast("Yummy!");
            
            // Kaka ihtimali
            if(Math.random() > 0.7) setTimeout(makePoop, 3000);
        }

        // --- BANYO Sƒ∞STEMƒ∞ ---
        function selectTool(toolName) {
            state.activeTool = toolName;
            document.querySelectorAll('.tool').forEach(t => t.classList.remove('selected'));
            document.getElementById('tool-' + toolName).classList.add('selected');
            
            cursorTool.innerText = (toolName === 'sponge') ? 'üßΩ' : 'üöø';
        }

        function generateDirt() {
            // Ba≈ülangƒ±√ßta karakter √ºzerinde rastgele lekeler olu≈ütur
            for(let i=0; i<5; i++) {
                createDirtSpot();
            }
        }

        function createDirtSpot() {
            const dirt = document.createElement('div');
            dirt.className = 'dirt-spot';
            // Rastgele konum (Pou i√ßinde)
            const top = 30 + Math.random() * 80;
            const left = 30 + Math.random() * 90;
            dirt.style.top = top + 'px';
            dirt.style.left = left + 'px';
            pou.appendChild(dirt);
        }

        function scrub(x, y) {
            // S√ºnger ile ovalama -> K√∂p√ºk olu≈ütur
            // Sadece hareket ettik√ße k√∂p√ºk ekle (performans i√ßin throttle eklenebilir)
            if (Math.random() > 0.8) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                // Pou'ya g√∂re g√∂receli konum (basitle≈ütirilmi≈ü)
                const pouRect = pou.getBoundingClientRect();
                bubble.style.left = (x - pouRect.left - 10) + 'px';
                bubble.style.top = (y - pouRect.top - 10) + 'px';
                pou.appendChild(bubble);
            }
        }

        function rinse(x, y) {
            // Du≈ü ba≈ülƒ±ƒüƒ± -> K√∂p√ºkleri ve kirleri sil
            // Basit√ße: O anki konuma yakƒ±n k√∂p√ºkleri bul ve sil
            const elements = document.elementsFromPoint(x, y);
            elements.forEach(el => {
                if (el.classList.contains('bubble') || el.classList.contains('dirt-spot')) {
                    el.remove();
                    if (el.classList.contains('dirt-spot')) {
                        state.clean = Math.min(100, state.clean + 20);
                        state.coins += 2;
                        showToast("Temizleniyor! +2üí∞");
                    }
                }
            });
        }

        // --- Dƒ∞ƒûER √ñZELLƒ∞KLER ---
        function checkGrowth() {
            // B√ºy√ºd√ºk√ße ≈üi≈ümanlasƒ±n
            let scale = 1 + (state.growth / 200);
            pou.style.transform = `scale(${scale})`;
            document.getElementById('level-val').innerText = Math.floor(state.growth / 50) + 1;
        }

        function makePoop() {
            // Ekrana kaka ekle (basit)
            const poop = document.createElement('div');
            poop.innerText = 'üí©';
            poop.style.position = 'absolute';
            poop.style.fontSize = '40px';
            poop.style.bottom = '20px';
            poop.style.left = (Math.random() * 60 + 20) + '%';
            poop.style.cursor = 'pointer';
            poop.onclick = function() { 
                this.remove(); 
                state.coins += 5; 
                state.clean -= 5;
                showToast("Kaka temizlendi! +5üí∞");
                // Yeni leke
                createDirtSpot();
            };
            document.getElementById('character-container').appendChild(poop);
        }

        function toggleSleep() {
            state.isSleeping = !state.isSleeping;
            if(state.isSleeping) {
                document.body.style.filter = "brightness(0.4)";
                document.querySelectorAll('.eye').forEach(e => e.style.height = '2px');
                showToast("ƒ∞yi geceler...");
            } else {
                document.body.style.filter = "brightness(1)";
                document.querySelectorAll('.eye').forEach(e => e.style.height = '40px');
            }
        }

        function updateUI() {
            document.getElementById('bar-hunger').style.width = state.hunger + '%';
            document.getElementById('bar-clean').style.width = state.clean + '%';
            document.getElementById('bar-energy').style.width = state.energy + '%';
            document.getElementById('coin-val').innerText = state.coins;
        }
        
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.opacity = 1;
            setTimeout(()=>t.style.opacity=0, 2000);
        }
        
        // --- SES KAYIT & PITCH SHIFT (Mevcut koddan uyarlandƒ±) ---
        let audioCtx, mediaRecorder, chunks = [];
        async function toggleMic() {
            const btn = document.getElementById('btn-mic');
            if(btn.classList.contains('mic-active')) {
                // Stop
                mediaRecorder.stop();
                btn.classList.remove('mic-active');
            } else {
                // Start
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    mediaRecorder = new MediaRecorder(stream);
                    chunks = [];
                    mediaRecorder.ondataavailable = e => chunks.push(e.data);
                    mediaRecorder.onstop = playBack;
                    mediaRecorder.start();
                    btn.classList.add('mic-active');
                    showToast("Dinliyorum...");
                    mouth.style.height = "25px"; mouth.style.borderRadius="50%"; // Aƒüƒ±z a√ß
                } catch(e) { alert("Mikrofon izni gerekli!"); }
            }
        }
        async function playBack() {
            const blob = new Blob(chunks, {type:'audio/webm'});
            const arrBuffer = await blob.arrayBuffer();
            const audioBuffer = await audioCtx.decodeAudioData(arrBuffer);
            const source = audioCtx.createBufferSource();
            source.buffer = audioBuffer;
            source.playbackRate.value = 1.4; // ƒ∞nce ses
            source.connect(audioCtx.destination);
            source.start();
            mouth.style.height = "10px"; // Aƒüƒ±z kapa
            // Zƒ±plama efekti
            pou.style.transform += " translateY(-20px)";
            setTimeout(()=> pou.style.transform = pou.style.transform.replace("translateY(-20px)", ""), 200);
        }

        // Ba≈ülat
        init();

    </script>
</body>
</html>
